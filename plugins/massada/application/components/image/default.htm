<style>
	.avatar-view {
	  display: block;
	  height: 200px;
	  width: 200px;
	  border: 3px solid #fff;
	  border-radius: 5px;
	  box-shadow: 0 0 5px rgba(0,0,0,.15);
	  cursor: pointer;
	  overflow: hidden;
}

    .cropArea {
      background: #E4E4E4;
      overflow: hidden;
      width:500px;
      height:350px;
    }

	@media (min-width: 1200px) {
        .modal-dialog {
            width: 1170px!important;
        }
    }
    
    @media (min-width: 992px) {
        .modal-dialog {
            width: 970px!important;
        }
    }

</style>


<script>
	app.controller('{{ __SELF__.mId }}', function($scope) {

		$scope.{{ __SELF__.mModel }}='';
    	$scope.img='';


    	var handleFileSelect=function(evt) {
      		var file = evt.currentTarget.files[0];
      		var reader = new FileReader();
      		reader.onload = function (evt) {
        		$scope.$apply(function($scope){
      				$scope.{{ __SELF__.mModel }}=evt.target.result;
        		});
      		};
      		reader.readAsDataURL(file);
    	};
    	angular.element(document.querySelector('#fileToUpload')).on('change',handleFileSelect);



		function errorBundle() {
			$scope.status = "has-error";
			$scope.icon = "form-control-feedback glyphicon glyphicon-remove";
			$scope.messageStatus="message-status-error";
		}

		function neutralBundle() {
			$scope.status="";
			$scope.icon="";
			$scope.messageStatus="";
		}

		function warningBundle() {
			$scope.status="has-warning";
			$scope.icon="glyphicon glyphicon-warning-sign form-control-feedback";
			$scope.messageStatus="message-status-warning";
		}


		$scope.$watch('{{ __SELF__.mModel }}', function(newValue, oldValue) {
			var a = $scope.{{ __SELF__.mModel }};
			//first input

			var required 		= '{{ __SELF__.mRequired }}';
			var required_msg 	= '{{ __SELF__.mRequired_msg }}';

			//console.log($scope.mValue);

			switch (true) {

				case angular.isUndefined(a) : //untouched
					$scope.message = '';
					neutralBundle();break;
				
				case a == '' && required == 'false' : //touched and empty
					$scope.message = '';
					warningBundle();break;

				case a == '' && required == 'true' : //required
					$scope.message = '* ' + required_msg;
					errorBundle();break;
		
				default :
					$scope.message = "";
					$scope.status="has-success";
					$scope.icon="glyphicon glyphicon-ok form-control-feedback";
					$scope.messageStatus="";
					break;
			}
		});

	});
</script>
  
<div ng-controller="{{ __SELF__.mId }}">	
	 <div class="form-group">
       		
		<div class="avatar-view" title="Change the avatar" data-toggle="modal" id="tae" data-target="#{{ __SELF__.mSource }}"> 	
			<img ng-src="{{ '{{ img }}' }}">
		</div>
		{% set src='{{ img }}' %} 
		<input type="text" name="forpost" ng-model="img" hidden>

	</div>

	<!-- crop modal -->
	<div class="modal fade" id="{{ __SELF__.mSource }}">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal">
	                    <span aria-hidden="true">Ã—</span>
	                    <span class="sr-only">Close</span>
	                </button>
	                <h4 class="modal-title">Crop Photo</h4>
	            </div>

	            <div class="modal-body">
	                <div class="container-fluid">
	                    <div class="col-md-8 col-sm-7">

	  						<div class="form-group">
	  						    <label for="{{ __SELF__.mId }}" class="col-sm-5 col-md-4 control-label">Source File :</label>
	  						    <div class="col-sm-7 col-md-8">
	  						        <input type="file" name="fileToUpload" id="fileToUpload" >
	  						    </div>
	  						</div>
	  						<div class="cropArea">
	  							<img-crop image="{{ __SELF__.mModel }}" area-type="square" result-image="img"></img-crop>
	  						</div>
	                    </div>

	                    <div class="col-md-4 col-sm-5">
	                    	<div class="form-group">
							    <label class="control-label">Preview :</label>
							</div>
							<img ng-src="{{ '{{ img }}' }}" />
	                    </div>
	                </div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	                <button type="button" class="btn btn-primary" 
	                		data-request="{{ __SELF__ }}::onCrop" 
	                		data-dismiss="modal">Save</button>         
	            </div>
	        </div>
	    </div>
	</div>

</div>